---
title: "Gráfico reproducible de FINANCIAL TIMES sobre el COVID-19"
output:
  md_document:
    variant: gfm
    preserve_yaml: TRUE
knit: (function(inputFile, encoding) {
   rmarkdown::render(inputFile, encoding = encoding, output_dir = "../_posts") })
author: "steve"
date: '2020-03-26'
excerpt: "Esta es mi primera publicación y consistirá en reproducir un gráfico de FINANCIAL TIMES sobre la propagación del COVID-19."
layout: post
categories:
  - R
image: "british-immigration.jpg"
---

{% include image.html url="/images/financial-times.png" caption="Financial Times" width=300 align="right" href="https://www.ft.com/" %}

Esta es mi primera publicación para realizar gráficos de series temporales del número de *Casos confirmados* con la base de datos otorgado por *European Centre for Disease Prevention and Control* [(ECDC)](https://www.ecdc.europa.eu/en) en *R*.

Los costos humanitarios del brote de coronavirus continúan aumentando, con más de 585.000 personas infectadas en todo el mundo. El número de personas que se ha confirmado que han muerto como resultado del virus ha superado ya las 26.800. 

La proliferación del virus ha sido declarada como pandemia por la Organización Mundial de la Salud, lo que significa que se está extendiendo rápidamente en diferentes partes del mundo. Más de 180 países han confirmado casos hasta ahora. El epicentro del coronavirus es ahora Europa, con el mayor número de casos confirmados en Italia, y el número de muertes crece más rápidamente en Italia, España, el Reino Unido y los EE.UU. que en China en la misma etapa del brote.

(Actualización de la situación 27 de marzo de 2020, conjunto de datos recogidos 6:00-10:00 CET)

## La Replicación

Esta réplica dependerá de unos pocos paquetes. `tidyverse` está al frente de mi flujo de trabajo. Y los paquetes `httr` y `readxl` cargará la base de datos. Llamaré a algunas funciones de `forcats` para procesar la información de los gráficos.

```r
library(tidyverse)
library(httr)
library(readxl)

# Los datos se cargarán actualizados
url <- paste("https://www.ecdc.europa.eu/sites/default/files/documents/COVID-19-geographic-disbtribution-worldwide-",
            format(Sys.time(),
            "%Y-%m-%d"),
            ".xlsx",
            sep = "")
GET(url,
  authenticate(":", ":", type="ntlm"),
  write_disk(tf <- tempfile(fileext = ".xlsx")))
data <- read_excel(tf)
```

### Los Datos

El marco de datos se almacena como `uniondensity`. Tiene 7126 filas con 10 columnas. La primera columna, `dateRep` la fecha intuitivamente. De la columna 2 a la 4 representará `day`, `month` y `year` respectivamente. Las columnas que nos vamos a enfocar para realizar el gráfico será el número de casos (`cases`) que no representará la suma acumulada hasta la actualidad (27 de marzo de 2020). La columna 7 será el nombre completo de cada país `countryterritoryCode` y el identificador conrrespondiente a cada país como `geoId`.



```r
topdat = data %>%
  group_by(geoId) %>%
  summarize(n = max(cases)) %>% #sacar el num. maximo de casos en un día
  filter(n >= 257) %>% # filter(geoId == "EC" | geoId == "CN") %>%
  arrange(desc(n)) #ordenar en forma descendente
```
